<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Simulaci√≥n 3D de la Tierra - Three.js WebGL</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000011;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000011 0%, #001122 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            font-size: 18px;
        }
        
        #loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 100;
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            border-radius: 12px;
            max-width: 320px;
            border: 2px solid #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            display: none;
        }
        
        .control-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 8px 0;
            height: 6px;
            border-radius: 5px;
            background: #333;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px 3px;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        button:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        h3 {
            margin: 0 0 15px 0;
            color: #4CAF50;
            text-align: center;
            font-size: 18px;
        }
        
        .crater-info {
            background: linear-gradient(45deg, rgba(76, 175, 80, 0.2), rgba(69, 160, 73, 0.2));
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 16px;
            border: 1px solid #4CAF50;
        }
        
        #debug-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #333;
            max-width: 300px;
            display: none;
        }
        
        #notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            border: 2px solid #4CAF50;
            font-size: 16px;
            z-index: 1000;
            display: none;
            text-align: center;
        }
        
        .success-message {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            color: #4CAF50;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
            color: #ff5555;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div id="loading-spinner"></div>
        <h2>üåç Cargando Simulaci√≥n 3D</h2>
        <p id="loading-status">Inicializando Three.js con WebGL...</p>
        <div id="loading-progress"></div>
    </div>
    
    <div id="canvas-container">
        <!-- El canvas de Three.js se insertar√° aqu√≠ -->
    </div>
    
    <div id="ui">
        <h3>üåç Simulaci√≥n 3D de la Tierra</h3>
        
        <div class="crater-info">
            <strong>üåã Cr√°teres: <span id="crater-count">0</span></strong>
        </div>
        
        <div class="control-group">
            <label>üîÑ Velocidad de Rotaci√≥n:</label>
            <input type="range" id="rotation-speed" min="0" max="5" step="0.1" value="1">
            <span id="speed-display">Normal</span>
        </div>
        
        <div class="control-group">
            <label>üìè Tama√±o de Cr√°ter:</label>
            <input type="range" id="crater-size" min="0.05" max="0.3" step="0.01" value="0.1">
            <span id="size-display">Medio</span>
        </div>
        
        <div class="control-group">
            <button id="add-crater">üåã Agregar Cr√°ter</button>
            <button id="add-multiple">üí• 5 Cr√°teres</button>
            <button id="clear-craters">üßπ Limpiar Todo</button>
        </div>
        
        <div class="control-group">
            <button id="toggle-wireframe">üìê Wireframe</button>
            <button id="reset-camera">üéØ Resetear C√°mara</button>
            <button id="toggle-rotation">‚è∏Ô∏è Pausar Rotaci√≥n</button>
        </div>
        
        <div class="control-group">
            <button id="random-impact">üöÄ Impacto Aleatorio</button>
            <button id="full-screen">üñ•Ô∏è Pantalla Completa</button>
        </div>
    </div>
    
    <div id="debug-info">
        <div><strong>üîç Informaci√≥n del Sistema:</strong></div>
        <div id="three-version"></div>
        <div id="webgl-version"></div>
        <div id="renderer-info"></div>
        <div id="performance-info"></div>
    </div>
    
    <div id="notification"></div>

    <!-- Three.js desde m√∫ltiples CDNs con fallback -->
    <script>
        // ==========================================
        // üöÄ SISTEMA DE CARGA INTELIGENTE THREE.JS
        // ==========================================
        
        console.log('üöÄ Iniciando sistema de carga Three.js optimizado...');
        
        // Variables globales
        let scene, camera, renderer, earth, controls;
        let craters = [];
        let earthRotationSpeed = 0.005;
        let craterSize = 0.1;
        let isRotating = true;
        let animationId;
        
        // Configuraci√≥n de CDNs en orden de preferencia
        const CDN_CONFIGS = [
            {
                name: 'jsDelivr',
                three: 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js'
            },
            {
                name: 'unpkg',
                three: 'https://unpkg.com/three@0.158.0/build/three.min.js'
            },
            {
                name: 'Three.js Official',
                three: 'https://threejs.org/build/three.min.js'
            }
        ];
        
        // ==========================================
        // FUNCIONES DE CARGA Y INICIALIZACI√ìN
        // ==========================================
        
        function updateLoadingStatus(message, progress = null) {
            const statusElement = document.getElementById('loading-status');
            const progressElement = document.getElementById('loading-progress');
            
            if (statusElement) {
                statusElement.textContent = message;
            }
            
            if (progress !== null && progressElement) {
                progressElement.innerHTML = `
                    <div style="width: 200px; height: 10px; background: #333; border-radius: 5px; margin: 10px 0;">
                        <div style="width: ${progress}%; height: 100%; background: #4CAF50; border-radius: 5px; transition: width 0.3s;"></div>
                    </div>
                    <small>${progress}% completado</small>
                `;
            }
            
            console.log('üîÑ', message);
        }
        
        function loadScript(url, timeout = 15000) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.async = true;
                
                const timer = setTimeout(() => {
                    script.remove();
                    reject(new Error(`Timeout: ${url}`));
                }, timeout);
                
                script.onload = () => {
                    clearTimeout(timer);
                    resolve();
                };
                
                script.onerror = () => {
                    clearTimeout(timer);
                    script.remove();
                    reject(new Error(`Error loading: ${url}`));
                };
                
                document.head.appendChild(script);
            });
        }
        
        async function loadThreeJS() {
            updateLoadingStatus('üîç Buscando mejor CDN...', 10);
            
            for (let i = 0; i < CDN_CONFIGS.length; i++) {
                const config = CDN_CONFIGS[i];
                
                try {
                    updateLoadingStatus(`üì° Probando ${config.name}...`, 20 + (i * 20));
                    
                    await loadScript(config.three);
                    
                    // Verificar que THREE est√© disponible
                    if (typeof THREE === 'undefined') {
                        throw new Error('THREE no definido');
                    }
                    
                    updateLoadingStatus(`‚úÖ ${config.name} cargado correctamente!`, 70);
                    console.log(`‚úÖ Three.js cargado desde ${config.name}`);
                    return true;
                    
                } catch (error) {
                    console.warn(`‚ùå Fall√≥ ${config.name}:`, error.message);
                    
                    if (i === CDN_CONFIGS.length - 1) {
                        throw new Error('Todos los CDNs fallaron');
                    }
                }
            }
        }
        
        // ==========================================
        // INICIALIZACI√ìN DE LA ESCENA 3D
        // ==========================================
        
        function initThreeJS() {
            updateLoadingStatus('üéÆ Configurando WebGL...', 75);
            
            try {
                // Crear escena
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000011);
                
                // Configurar c√°mara
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 0, 5);
                
                // Configurar renderer con WebGL
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true 
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // Agregar canvas al DOM
                const container = document.getElementById('canvas-container');
                container.appendChild(renderer.domElement);
                
                updateLoadingStatus('üåç Creando la Tierra...', 85);
                
                // Crear la Tierra
                createEarth();
                
                // Crear iluminaci√≥n
                createLighting();
                
                // Crear estrellas
                createStarField();
                
                // Configurar controles b√°sicos
                setupControls();
                
                // Configurar eventos
                setupEventListeners();
                
                updateLoadingStatus('üöÄ Iniciando animaci√≥n...', 95);
                
                // Iniciar loop de animaci√≥n
                animate();
                
                // Mostrar UI y ocultar loading
                hideLoading();
                
                updateLoadingStatus('üéâ ¬°Simulaci√≥n 3D lista!', 100);
                showNotification('üåç ¬°Simulaci√≥n 3D de la Tierra cargada!', 3000);
                
                console.log('üéâ Simulaci√≥n 3D inicializada correctamente');
                
            } catch (error) {
                console.error('‚ùå Error inicializando Three.js:', error);
                showError('Error inicializando gr√°ficos 3D: ' + error.message);
            }
        }
        
        function createEarth() {
            // Geometr√≠a de la Tierra
            const geometry = new THREE.SphereGeometry(2, 64, 64);
            
            // Crear textura procedural de la Tierra
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            // Fondo oc√©ano
            ctx.fillStyle = '#1565C0';
            ctx.fillRect(0, 0, 512, 256);
            
            // Continentes verdes
            ctx.fillStyle = '#2E7D32';
            
            // Continente 1 (Am√©rica)
            ctx.beginPath();
            ctx.ellipse(120, 100, 30, 80, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Continente 2 (Europa/√Åfrica)
            ctx.beginPath();
            ctx.ellipse(280, 120, 40, 60, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Continente 3 (Asia)
            ctx.beginPath();
            ctx.ellipse(380, 80, 50, 40, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Continente 4 (Ocean√≠a)
            ctx.beginPath();
            ctx.ellipse(420, 180, 25, 20, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Islas adicionales
            for (let i = 0; i < 15; i++) {
                ctx.beginPath();
                const x = Math.random() * 512;
                const y = Math.random() * 256;
                const radius = Math.random() * 8 + 3;
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Crear textura desde canvas
            const texture = new THREE.CanvasTexture(canvas);
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.ClampToEdgeWrapping;
            
            // Material de la Tierra con textura
            const material = new THREE.MeshPhongMaterial({
                map: texture,
                shininess: 10
            });
            
            // Crear la Tierra
            earth = new THREE.Mesh(geometry, material);
            earth.castShadow = true;
            earth.receiveShadow = true;
            
            scene.add(earth);
            console.log('üåç Tierra creada con textura procedural');
        }
        

        
        function createLighting() {
            // Luz ambiente
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            // Luz direccional (sol)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            
            // Configurar sombras
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            
            scene.add(directionalLight);
            
            // Luz puntual adicional
            const pointLight = new THREE.PointLight(0xffffff, 0.3, 100);
            pointLight.position.set(-10, -10, -5);
            scene.add(pointLight);
            
            console.log('üí° Sistema de iluminaci√≥n configurado');
        }
        
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 1000;
            
            const positions = new Float32Array(starCount * 3);
            
            for (let i = 0; i < starCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 200;
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 2,
                sizeAttenuation: false
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
            
            console.log('‚ú® Campo de estrellas 3D creado');
        }
        
        // ==========================================
        // SISTEMA DE CR√ÅTERES 3D
        // ==========================================
        
        function addCrater() {
            // Crear geometr√≠a del cr√°ter como una depresi√≥n
            const craterGeometry = new THREE.RingGeometry(craterSize * 0.3, craterSize, 8, 1);
            const craterMaterial = new THREE.MeshPhongMaterial({
                color: 0x5D4037,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });
            
            const crater = new THREE.Mesh(craterGeometry, craterMaterial);
            
            // Posici√≥n aleatoria en la superficie de la Tierra
            const phi = Math.random() * Math.PI * 2;
            const theta = Math.random() * Math.PI;
            
            const radius = 2.01; // Ligeramente sobre la superficie
            const x = radius * Math.sin(theta) * Math.cos(phi);
            const y = radius * Math.sin(theta) * Math.sin(phi);
            const z = radius * Math.cos(theta);
            
            crater.position.set(x, y, z);
            
            // Orientar el cr√°ter hacia afuera desde el centro de la Tierra
            const normal = new THREE.Vector3(x, y, z).normalize();
            crater.lookAt(crater.position.clone().add(normal));
            
            // A√±adir el cr√°ter como hijo de la Tierra para que rote con ella
            earth.add(crater);
            craters.push(crater);
            
            // Crear efecto de impacto
            const impactGeometry = new THREE.SphereGeometry(craterSize * 0.5, 8, 8);
            const impactMaterial = new THREE.MeshPhongMaterial({
                color: 0x8B4513,
                transparent: true,
                opacity: 0.6
            });
            
            const impact = new THREE.Mesh(impactGeometry, impactMaterial);
            impact.position.set(x * 0.98, y * 0.98, z * 0.98); // Ligeramente dentro
            earth.add(impact);
            craters.push(impact);
            
            updateCraterCount();
            showNotification(`üåã Cr√°ter #${Math.floor(craters.length/2)} a√±adido`, 1000);
            
            console.log(`üåã Cr√°ter 3D #${Math.floor(craters.length/2)} creado`);
        }
        
        function addMultipleCraters() {
            showNotification('üí• ¬°Impactos m√∫ltiples!', 2000);
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    addCrater();
                }, i * 300);
            }
        }
        
        function clearAllCraters() {
            craters.forEach(crater => {
                earth.remove(crater); // Remover de la Tierra, no de la escena
            });
            
            craters = [];
            updateCraterCount();
            showNotification('üßπ Superficie restaurada', 1500);
            console.log('üßπ Todos los cr√°teres eliminados');
        }
        
        function randomImpact() {
            const impactTypes = [
                { count: 1, size: 0.05, message: '‚òÑÔ∏è Asteroide peque√±o' },
                { count: 2, size: 0.1, message: 'üí´ Meteorito mediano' },
                { count: 3, size: 0.15, message: 'üåü Impacto de cometa' },
                { count: 1, size: 0.25, message: 'üí• ASTEROIDE MASIVO' }
            ];
            
            const impact = impactTypes[Math.floor(Math.random() * impactTypes.length)];
            const originalSize = craterSize;
            
            craterSize = impact.size;
            showNotification(impact.message, 2000);
            
            for (let i = 0; i < impact.count; i++) {
                setTimeout(() => {
                    addCrater();
                }, i * 200);
            }
            
            setTimeout(() => {
                craterSize = originalSize;
                updateSizeDisplay();
            }, 1000);
        }
        
        // ==========================================
        // CONTROLES Y ANIMACI√ìN
        // ==========================================
        
        function setupControls() {
            // Controles de mouse b√°sicos
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isMouseDown = true;
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            document.addEventListener('mouseup', () => {
                isMouseDown = false;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isMouseDown) return;
                
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                
                earth.rotation.y += deltaX * 0.01;
                earth.rotation.x += deltaY * 0.01;
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            // Zoom con rueda del mouse
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                
                const zoomSpeed = 0.1;
                if (e.deltaY > 0) {
                    camera.position.z = Math.min(camera.position.z + zoomSpeed, 10);
                } else {
                    camera.position.z = Math.max(camera.position.z - zoomSpeed, 2);
                }
            });
            
            console.log('üéÆ Controles de mouse configurados');
        }
        
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // Rotar la Tierra autom√°ticamente
            if (isRotating && earth) {
                earth.rotation.y += earthRotationSpeed;
            }
            
            // Renderizar la escena
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        // ==========================================
        // EVENTOS DE UI
        // ==========================================
        
        function setupEventListeners() {
            // Sliders
            const rotationSlider = document.getElementById('rotation-speed');
            if (rotationSlider) {
                rotationSlider.addEventListener('input', (e) => {
                    earthRotationSpeed = parseFloat(e.target.value) * 0.005;
                    updateSpeedDisplay();
                });
            }
            
            const sizeSlider = document.getElementById('crater-size');
            if (sizeSlider) {
                sizeSlider.addEventListener('input', (e) => {
                    craterSize = parseFloat(e.target.value);
                    updateSizeDisplay();
                });
            }
            
            // Botones
            document.getElementById('add-crater')?.addEventListener('click', addCrater);
            document.getElementById('add-multiple')?.addEventListener('click', addMultipleCraters);
            document.getElementById('clear-craters')?.addEventListener('click', clearAllCraters);
            document.getElementById('random-impact')?.addEventListener('click', randomImpact);
            
            document.getElementById('toggle-wireframe')?.addEventListener('click', () => {
                if (earth) {
                    earth.material.wireframe = !earth.material.wireframe;
                }
            });
            
            document.getElementById('reset-camera')?.addEventListener('click', () => {
                camera.position.set(0, 0, 5);
                camera.lookAt(0, 0, 0);
                if (earth) {
                    earth.rotation.set(0, 0, 0);
                }
                showNotification('üéØ C√°mara reiniciada', 1000);
            });
            
            document.getElementById('toggle-rotation')?.addEventListener('click', () => {
                isRotating = !isRotating;
                const button = document.getElementById('toggle-rotation');
                button.textContent = isRotating ? '‚è∏Ô∏è Pausar Rotaci√≥n' : '‚ñ∂Ô∏è Reanudar Rotaci√≥n';
                showNotification(isRotating ? '‚ñ∂Ô∏è Rotaci√≥n activada' : '‚è∏Ô∏è Rotaci√≥n pausada', 1000);
            });
            
            document.getElementById('full-screen')?.addEventListener('click', () => {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    document.documentElement.requestFullscreen();
                }
            });
            
            // Eventos de teclado
            document.addEventListener('keydown', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'c':
                        addCrater();
                        break;
                    case 'x':
                        clearAllCraters();
                        break;
                    case ' ':
                        e.preventDefault();
                        document.getElementById('toggle-rotation')?.click();
                        break;
                    case 'r':
                        document.getElementById('reset-camera')?.click();
                        break;
                    case 'm':
                        addMultipleCraters();
                        break;
                    case 'i':
                        randomImpact();
                        break;
                    case 'w':
                        document.getElementById('toggle-wireframe')?.click();
                        break;
                    case 'f':
                        document.getElementById('full-screen')?.click();
                        break;
                }
            });
            
            // Redimensionar ventana
            window.addEventListener('resize', () => {
                if (camera && renderer) {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                }
            });
            
            console.log('üéÆ Event listeners configurados');
        }
        
        // ==========================================
        // UTILIDADES Y UI
        // ==========================================
        
        function updateCraterCount() {
            const countElement = document.getElementById('crater-count');
            if (countElement) {
                countElement.textContent = Math.floor(craters.length / 2); // Cada cr√°ter tiene 2 elementos
            }
        }
        
        function updateSpeedDisplay() {
            const display = document.getElementById('speed-display');
            if (display) {
                const speed = earthRotationSpeed / 0.005;
                if (speed === 0) display.textContent = 'Detenido';
                else if (speed < 1) display.textContent = 'Lento';
                else if (speed === 1) display.textContent = 'Normal';
                else display.textContent = 'R√°pido';
            }
        }
        
        function updateSizeDisplay() {
            const display = document.getElementById('size-display');
            if (display) {
                if (craterSize <= 0.07) display.textContent = 'Peque√±o';
                else if (craterSize <= 0.15) display.textContent = 'Medio';
                else if (craterSize <= 0.2) display.textContent = 'Grande';
                else display.textContent = 'Masivo';
            }
        }
        
        function showNotification(message, duration = 2000) {
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, duration);
            }
        }
        
        function hideLoading() {
            const loading = document.getElementById('loading');
            const ui = document.getElementById('ui');
            const debugInfo = document.getElementById('debug-info');
            
            loading.style.display = 'none';
            ui.style.display = 'block';
            debugInfo.style.display = 'block';
            
            // Actualizar informaci√≥n de debug
            updateDebugInfo();
        }
        
        function updateDebugInfo() {
            if (typeof THREE !== 'undefined') {
                document.getElementById('three-version').textContent = `Three.js: r${THREE.REVISION}`;
            }
            
            if (renderer) {
                const gl = renderer.getContext();
                document.getElementById('webgl-version').textContent = `WebGL: ${gl.getParameter(gl.VERSION)}`;
                
                const info = renderer.info;
                document.getElementById('renderer-info').textContent = `Tri√°ngulos: ${info.render.triangles}`;
                document.getElementById('performance-info').textContent = `Calls: ${info.render.calls}`;
            }
        }
        
        function showError(message) {
            const loading = document.getElementById('loading');
            loading.innerHTML = `
                <div class="error-message">
                    <h3>‚ùå Error de Inicializaci√≥n</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()">üîÑ Reintentar</button>
                    <button onclick="window.open('earth-offline.html', '_blank')">üåç Usar Versi√≥n 2D</button>
                </div>
            `;
        }
        
        // ==========================================
        // INICIALIZACI√ìN PRINCIPAL
        // ==========================================
        
        async function startApp() {
            try {
                updateLoadingStatus('üîç Verificando WebGL...', 5);
                
                // Verificar WebGL
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (!gl) {
                    throw new Error('WebGL no soportado');
                }
                
                updateLoadingStatus('‚úÖ WebGL confirmado, cargando Three.js...', 10);
                
                // Cargar Three.js
                await loadThreeJS();
                
                // Inicializar Three.js
                initThreeJS();
                
            } catch (error) {
                console.error('‚ùå Error fatal:', error);
                showError(error.message);
            }
        }
        
        // Iniciar aplicaci√≥n cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startApp);
        } else {
            startApp();
        }
        
        console.log(`
        üåç SIMULACI√ìN 3D DE LA TIERRA - THREE.JS WEBGL
        ===============================================
        
        ‚ú® Caracter√≠sticas optimizadas:
        ‚Ä¢ WebGL verificado y funcional
        ‚Ä¢ Sistema de CDN con fallbacks inteligentes
        ‚Ä¢ Gr√°ficos 3D reales con Three.js
        ‚Ä¢ Controles interactivos de mouse
        ‚Ä¢ Sistema de cr√°teres 3D
        ‚Ä¢ Iluminaci√≥n realista y sombras
        
        üéÆ Controles:
        ‚Ä¢ Mouse: Rotar la Tierra
        ‚Ä¢ Rueda: Zoom
        ‚Ä¢ C: A√±adir cr√°ter
        ‚Ä¢ M: M√∫ltiples cr√°teres
        ‚Ä¢ I: Impacto aleatorio
        ‚Ä¢ X: Limpiar todo
        ‚Ä¢ W: Wireframe
        ‚Ä¢ F: Pantalla completa
        ‚Ä¢ Espacio: Pausar/Reanudar
        ‚Ä¢ R: Resetear c√°mara
        
        üöÄ ¬°Versi√≥n 3D completamente funcional!
        `);
        
    </script>
</body>
</html>