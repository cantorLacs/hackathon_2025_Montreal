<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Simulaci√≥n de la Tierra - Versi√≥n Completa</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000011;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            max-width: 300px;
            border: 1px solid #333;
        }
        
        .control-group {
            margin: 12px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 3px;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 280px;
            border: 1px solid #333;
        }
        
        #status {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #00ff00;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #333;
        }
        
        kbd {
            background-color: #333;
            border: 1px solid #666;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 0 2px;
        }
        
        h3 {
            margin: 0 0 15px 0;
            color: #4CAF50;
            text-align: center;
        }
        
        .crater-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            text-align: center;
            font-size: 16px;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000011;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            font-size: 18px;
        }
        
        .spinner {
            border: 4px solid #333;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>üåç Cargando Simulaci√≥n de la Tierra</h2>
        <div class="spinner"></div>
        <p>Inicializando Three.js...</p>
    </div>
    
    <div id="canvas-container"></div>
    
    <div id="status" style="display: none;">
        <div>‚úÖ Three.js: Cargado</div>
        <div>üåç Tierra: Creada</div>
        <div>‚ú® Estrellas: Activas</div>
        <div>üéÆ Controles: Listos</div>
    </div>
    
    <div id="ui">
        <h3>üåç Simulaci√≥n de la Tierra</h3>
        
        <div class="crater-info">
            <strong>üåã Cr√°teres Activos: <span id="crater-count">0</span></strong>
        </div>
        
        <div class="control-group">
            <label>üîÑ Velocidad de Rotaci√≥n:</label>
            <input type="range" id="rotation-speed" min="0" max="2" step="0.1" value="0.5">
        </div>
        
        <div class="control-group">
            <label>üìè Tama√±o de Cr√°ter:</label>
            <input type="range" id="crater-size" min="0.1" max="3" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <button id="add-crater">üåã Agregar Cr√°ter</button>
            <button id="add-multiple">üí• 5 Cr√°teres</button>
            <button id="clear-craters">üßπ Limpiar Todo</button>
        </div>
        
        <div class="control-group">
            <button id="toggle-wireframe">üìê Wireframe</button>
            <button id="toggle-animation">‚è∏Ô∏è Pausar</button>
            <button id="reset-view">üéØ Centrar</button>
        </div>
    </div>
    
    <div id="info">
        <p><strong>üéÆ Controles:</strong></p>
        <p>‚Ä¢ <strong>Mouse:</strong> Click y arrastra para rotar</p>
        <p>‚Ä¢ <strong>Rueda:</strong> Zoom in/out</p>
        <p>‚Ä¢ <kbd>C</kbd> Agregar cr√°ter ‚Ä¢ <kbd>X</kbd> Limpiar</p>
        <p>‚Ä¢ <kbd>W</kbd> Wireframe ‚Ä¢ <kbd>Espacio</kbd> Pausar</p>
        <p>‚Ä¢ <kbd>R</kbd> Resetear vista</p>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/controls/OrbitControls.js"></script>
    
    <script>
        // ==========================================
        // üåç SIMULACI√ìN COMPLETA DE LA TIERRA
        // ==========================================
        
        console.log('üöÄ Iniciando simulaci√≥n de la Tierra...');
        
        // Variables globales
        let scene, camera, renderer, controls;
        let earth, earthGroup;
        let craters = [];
        let rotationSpeed = 0.005;
        let isAnimating = true;
        let craterSize = 1.0;
        
        // ==========================================
        // INICIALIZACI√ìN PRINCIPAL
        // ==========================================
        
        function init() {
            console.log('üìã Inicializando Three.js...');
            
            try {
                // Verificar Three.js
                if (typeof THREE === 'undefined') {
                    throw new Error('Three.js no est√° disponible');
                }
                
                // 1. Crear escena
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000011);
                console.log('‚úÖ Escena creada');
                
                // 2. Crear c√°mara
                camera = new THREE.PerspectiveCamera(
                    75, 
                    window.innerWidth / window.innerHeight, 
                    0.1, 
                    1000
                );
                camera.position.set(0, 0, 4);
                console.log('‚úÖ C√°mara configurada');
                
                // 3. Crear renderizador
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true 
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // Agregar al DOM
                const container = document.getElementById('canvas-container');
                if (container) {
                    container.appendChild(renderer.domElement);
                    console.log('‚úÖ Canvas agregado al DOM');
                } else {
                    throw new Error('No se encontr√≥ el contenedor canvas-container');
                }
                
                // 4. Controles de √≥rbita
                if (THREE.OrbitControls) {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.screenSpacePanning = false;
                    controls.minDistance = 1.5;
                    controls.maxDistance = 15;
                    controls.maxPolarAngle = Math.PI;
                    console.log('‚úÖ Controles de √≥rbita inicializados');
                } else {
                    console.warn('‚ö†Ô∏è OrbitControls no disponible, usando controles b√°sicos');
                }
                
                // 5. Configurar luces
                setupLighting();
                
                // 6. Crear campo de estrellas
                createStarField();
                
                // 7. Crear la Tierra
                createEarth();
                
                // 8. Configurar eventos
                setupEventListeners();
                
                // 9. Manejar redimensionamiento
                window.addEventListener('resize', onWindowResize);
                
                // 10. Ocultar pantalla de carga
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('status').style.display = 'block';
                    
                    setTimeout(() => {
                        document.getElementById('status').style.display = 'none';
                    }, 4000);
                }, 2000);
                
                console.log('üåü Inicializaci√≥n completa - ¬°Comenzando animaci√≥n!');
                
                // 11. Iniciar bucle de animaci√≥n
                animate();
                
            } catch (error) {
                console.error('‚ùå Error en inicializaci√≥n:', error);
                showError(error);
            }
        }
        
        // ==========================================
        // CONFIGURACI√ìN DE LUCES
        // ==========================================
        
        function setupLighting() {
            // Luz ambiente suave
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            // Luz direccional principal (Sol)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            
            // Configurar sombras
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -10;
            directionalLight.shadow.camera.right = 10;
            directionalLight.shadow.camera.top = 10;
            directionalLight.shadow.camera.bottom = -10;
            
            scene.add(directionalLight);
            
            // Luz de relleno
            const fillLight = new THREE.DirectionalLight(0x0066ff, 0.3);
            fillLight.position.set(-5, 3, -5);
            scene.add(fillLight);
            
            console.log('üí° Sistema de iluminaci√≥n configurado');
        }
        
        // ==========================================
        // CAMPO DE ESTRELLAS
        // ==========================================
        
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 8000;
            
            const positions = new Float32Array(starCount * 3);
            const colors = new Float32Array(starCount * 3);
            
            for (let i = 0; i < starCount; i++) {
                // Distribuci√≥n esf√©rica uniforme
                const radius = 50 + Math.random() * 100;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                
                positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
                positions[i * 3 + 1] = radius * Math.cos(phi);
                positions[i * 3 + 2] = radius * Math.sin(phi) * Math.sin(theta);
                
                // Colores variados para las estrellas
                const intensity = 0.4 + Math.random() * 0.6;
                const colorType = Math.random();
                
                if (colorType < 0.7) {
                    // Estrellas blancas/azuladas
                    colors[i * 3] = intensity;
                    colors[i * 3 + 1] = intensity;
                    colors[i * 3 + 2] = intensity + Math.random() * 0.2;
                } else if (colorType < 0.9) {
                    // Estrellas amarillas
                    colors[i * 3] = intensity + Math.random() * 0.2;
                    colors[i * 3 + 1] = intensity;
                    colors[i * 3 + 2] = intensity * 0.7;
                } else {
                    // Estrellas rojizas
                    colors[i * 3] = intensity + Math.random() * 0.3;
                    colors[i * 3 + 1] = intensity * 0.6;
                    colors[i * 3 + 2] = intensity * 0.4;
                }
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const starMaterial = new THREE.PointsMaterial({
                size: 1.5,
                sizeAttenuation: true,
                vertexColors: true,
                transparent: true,
                opacity: 0.8
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
            
            console.log('‚ú® Campo de estrellas creado con', starCount, 'estrellas');
        }
        
        // ==========================================
        // CREACI√ìN DE LA TIERRA
        // ==========================================
        
        function createEarth() {
            // Crear grupo para la Tierra
            earthGroup = new THREE.Group();
            scene.add(earthGroup);
            
            // Geometr√≠a de alta resoluci√≥n
            const geometry = new THREE.SphereGeometry(1, 64, 32);
            
            // Crear textura procedural de la Tierra
            const earthTexture = createEarthTexture();
            
            // Material realista
            const material = new THREE.MeshPhongMaterial({
                map: earthTexture,
                shininess: 100,
                specular: new THREE.Color(0x222222),
                transparent: false
            });
            
            // Crear la malla
            earth = new THREE.Mesh(geometry, material);
            earth.receiveShadow = true;
            earth.castShadow = true;
            
            earthGroup.add(earth);
            
            console.log('üåç Tierra creada con textura procedural');
        }
        
        // ==========================================
        // TEXTURA PROCEDURAL DE LA TIERRA
        // ==========================================
        
        function createEarthTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 512;
            const context = canvas.getContext('2d');
            
            // Crear gradiente oce√°nico de fondo
            const oceanGradient = context.createLinearGradient(0, 0, 0, 512);
            oceanGradient.addColorStop(0, '#001133');
            oceanGradient.addColorStop(0.3, '#003366');
            oceanGradient.addColorStop(0.7, '#0066cc');
            oceanGradient.addColorStop(1, '#004499');
            
            context.fillStyle = oceanGradient;
            context.fillRect(0, 0, 1024, 512);
            
            // Funci√≥n para crear continentes
            function drawContinent(x, y, width, height, color, roughness = 0.3) {
                context.fillStyle = color;
                context.beginPath();
                
                const points = [];
                const numPoints = 20;
                
                for (let i = 0; i <= numPoints; i++) {
                    const angle = (i / numPoints) * Math.PI * 2;
                    const radiusX = width * (0.5 + roughness * (Math.random() - 0.5));
                    const radiusY = height * (0.5 + roughness * (Math.random() - 0.5));
                    
                    const px = x + Math.cos(angle) * radiusX;
                    const py = y + Math.sin(angle) * radiusY;
                    
                    points.push([px, py]);
                }
                
                // Dibujar forma suavizada
                context.moveTo(points[0][0], points[0][1]);
                for (let i = 1; i < points.length; i++) {
                    const current = points[i];
                    const next = points[(i + 1) % points.length];
                    
                    const cpx = (current[0] + next[0]) / 2;
                    const cpy = (current[1] + next[1]) / 2;
                    
                    context.quadraticCurveTo(current[0], current[1], cpx, cpy);
                }
                context.closePath();
                context.fill();
            }
            
            // Dibujar continentes principales
            
            // Am√©rica del Norte
            drawContinent(150, 180, 120, 140, '#228B22', 0.4);
            
            // Am√©rica del Sur
            drawContinent(180, 320, 80, 120, '#32CD32', 0.5);
            
            // Europa y Asia
            drawContinent(450, 160, 200, 100, '#228B22', 0.3);
            drawContinent(580, 200, 180, 120, '#228B22', 0.4);
            
            // √Åfrica
            drawContinent(380, 280, 90, 140, '#32CD32', 0.4);
            
            // Australia
            drawContinent(650, 350, 80, 50, '#228B22', 0.3);
            
            // Groenlandia
            drawContinent(200, 100, 60, 70, '#90EE90', 0.5);
            
            // Islas adicionales
            for (let i = 0; i < 15; i++) {
                const x = Math.random() * 1024;
                const y = Math.random() * 512;
                const size = 10 + Math.random() * 30;
                
                drawContinent(x, y, size, size * 0.8, '#228B22', 0.6);
            }
            
            // Agregar algunas nubes/hielo polar
            context.globalAlpha = 0.3;
            context.fillStyle = '#ffffff';
            
            // Polo norte
            context.beginPath();
            context.ellipse(512, 50, 200, 30, 0, 0, 2 * Math.PI);
            context.fill();
            
            // Polo sur
            context.beginPath();
            context.ellipse(512, 460, 180, 25, 0, 0, 2 * Math.PI);
            context.fill();
            
            context.globalAlpha = 1.0;
            
            return new THREE.CanvasTexture(canvas);
        }
        
        // ==========================================
        // SISTEMA DE CR√ÅTERES AVANZADO
        // ==========================================
        
        function addCrater() {
            if (!earthGroup) {
                console.warn('‚ö†Ô∏è Earth group no disponible');
                return;
            }
            
            // Generar posici√≥n aleatoria en la superficie
            const phi = Math.random() * Math.PI;
            const theta = Math.random() * 2 * Math.PI;
            const radius = 1.0;
            
            const x = radius * Math.sin(phi) * Math.cos(theta);
            const y = radius * Math.cos(phi);
            const z = radius * Math.sin(phi) * Math.sin(theta);
            
            // Crear grupo del cr√°ter
            const craterGroup = new THREE.Group();
            
            // Tama√±o variable del cr√°ter
            const baseSize = 0.03 + Math.random() * 0.02;
            const actualSize = baseSize * craterSize;
            
            // 1. Depresi√≥n central
            const depressionGeometry = new THREE.SphereGeometry(
                actualSize, 
                16, 8, 
                0, Math.PI * 2, 
                0, Math.PI * 0.6
            );
            
            const depressionMaterial = new THREE.MeshPhongMaterial({
                color: new THREE.Color().setHSL(0.1, 0.8, 0.2), // Marr√≥n oscuro
                transparent: true,
                opacity: 0.9
            });
            
            const depression = new THREE.Mesh(depressionGeometry, depressionMaterial);
            depression.position.z = -actualSize * 0.3;
            craterGroup.add(depression);
            
            // 2. Anillo elevado
            const ringInnerRadius = actualSize * 1.1;
            const ringOuterRadius = actualSize * 1.8;
            const ringGeometry = new THREE.RingGeometry(ringInnerRadius, ringOuterRadius, 16);
            
            const ringMaterial = new THREE.MeshPhongMaterial({
                color: new THREE.Color().setHSL(0.08, 0.6, 0.4), // Tierra/roca
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });
            
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = -Math.PI / 2;
            craterGroup.add(ring);
            
            // 3. Debris/escombros (opcional)
            if (Math.random() > 0.4) {
                for (let i = 0; i < 3 + Math.random() * 4; i++) {
                    const debrisSize = actualSize * (0.1 + Math.random() * 0.2);
                    const debrisGeometry = new THREE.SphereGeometry(debrisSize, 8, 6);
                    
                    const debrisMaterial = new THREE.MeshPhongMaterial({
                        color: new THREE.Color().setHSL(0.12, 0.7, 0.3)
                    });
                    
                    const debris = new THREE.Mesh(debrisGeometry, debrisMaterial);
                    
                    // Posici√≥n aleatoria alrededor del cr√°ter
                    const debrisDistance = ringOuterRadius * (1.2 + Math.random() * 0.8);
                    const debrisAngle = Math.random() * Math.PI * 2;
                    
                    debris.position.set(
                        Math.cos(debrisAngle) * debrisDistance,
                        Math.sin(debrisAngle) * debrisDistance,
                        (Math.random() - 0.5) * actualSize * 0.5
                    );
                    
                    craterGroup.add(debris);
                }
            }
            
            // Posicionar en la superficie de la Tierra
            craterGroup.position.set(x, y, z);
            
            // Orientar hacia el exterior (normal de la superficie)
            const normal = new THREE.Vector3(x, y, z).normalize();
            craterGroup.lookAt(
                x + normal.x,
                y + normal.y,
                z + normal.z
            );
            
            // Agregar al grupo de la Tierra
            earthGroup.add(craterGroup);
            craters.push(craterGroup);
            
            // Actualizar contador
            updateCraterCount();
            
            console.log(`üåã Cr√°ter #${craters.length} creado - Tama√±o: ${(actualSize * 100).toFixed(1)}cm`);
            
            return craterGroup;
        }
        
        function addMultipleCraters() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    addCrater();
                }, i * 150);
            }
        }
        
        function clearAllCraters() {
            craters.forEach(crater => {
                earthGroup.remove(crater);
                
                // Limpiar geometr√≠as y materiales
                crater.traverse(child => {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            child.material.forEach(material => material.dispose());
                        } else {
                            child.material.dispose();
                        }
                    }
                });
            });
            
            craters = [];
            updateCraterCount();
            console.log('üßπ Todos los cr√°teres han sido eliminados');
        }
        
        function updateCraterCount() {
            const countElement = document.getElementById('crater-count');
            if (countElement) {
                countElement.textContent = craters.length;
                
                // Efecto visual en el contador
                countElement.style.transform = 'scale(1.2)';
                countElement.style.color = '#4CAF50';
                
                setTimeout(() => {
                    countElement.style.transform = 'scale(1)';
                    countElement.style.color = 'white';
                }, 200);
            }
        }
        
        // ==========================================
        // CONFIGURACI√ìN DE EVENTOS
        // ==========================================
        
        function setupEventListeners() {
            try {
                // Sliders
                const rotationSlider = document.getElementById('rotation-speed');
                if (rotationSlider) {
                    rotationSlider.addEventListener('input', (e) => {
                        rotationSpeed = parseFloat(e.target.value) * 0.01;
                    });
                }
                
                const sizeSlider = document.getElementById('crater-size');
                if (sizeSlider) {
                    sizeSlider.addEventListener('input', (e) => {
                        craterSize = parseFloat(e.target.value);
                    });
                }
                
                // Botones principales
                const addBtn = document.getElementById('add-crater');
                if (addBtn) addBtn.addEventListener('click', addCrater);
                
                const addMultipleBtn = document.getElementById('add-multiple');
                if (addMultipleBtn) addMultipleBtn.addEventListener('click', addMultipleCraters);
                
                const clearBtn = document.getElementById('clear-craters');
                if (clearBtn) clearBtn.addEventListener('click', clearAllCraters);
                
                const wireframeBtn = document.getElementById('toggle-wireframe');
                if (wireframeBtn) {
                    wireframeBtn.addEventListener('click', () => {
                        if (earth && earth.material) {
                            earth.material.wireframe = !earth.material.wireframe;
                            wireframeBtn.textContent = earth.material.wireframe ? 'üåê S√≥lido' : 'üìê Wireframe';
                        }
                    });
                }
                
                const animationBtn = document.getElementById('toggle-animation');
                if (animationBtn) {
                    animationBtn.addEventListener('click', () => {
                        isAnimating = !isAnimating;
                        animationBtn.textContent = isAnimating ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Reanudar';
                    });
                }
                
                const resetBtn = document.getElementById('reset-view');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => {
                        camera.position.set(0, 0, 4);
                        if (controls) {
                            controls.target.set(0, 0, 0);
                            controls.update();
                        }
                    });
                }
                
                // Eventos de teclado
                document.addEventListener('keydown', (e) => {
                    switch(e.key.toLowerCase()) {
                        case 'c':
                            addCrater();
                            break;
                        case 'x':
                            clearAllCraters();
                            break;
                        case ' ':
                            e.preventDefault();
                            isAnimating = !isAnimating;
                            break;
                        case 'w':
                            if (earth && earth.material) {
                                earth.material.wireframe = !earth.material.wireframe;
                            }
                            break;
                        case 'r':
                            camera.position.set(0, 0, 4);
                            if (controls) {
                                controls.target.set(0, 0, 0);
                                controls.update();
                            }
                            break;
                        case 'm':
                            addMultipleCraters();
                            break;
                    }
                });
                
                console.log('üéÆ Todos los event listeners configurados');
                
            } catch (error) {
                console.error('‚ùå Error configurando eventos:', error);
            }
        }
        
        // ==========================================
        // BUCLE DE ANIMACI√ìN
        // ==========================================
        
        function animate() {
            requestAnimationFrame(animate);
            
            try {
                // Rotar la Tierra
                if (isAnimating && earthGroup) {
                    earthGroup.rotation.y += rotationSpeed;
                }
                
                // Actualizar controles
                if (controls) {
                    controls.update();
                }
                
                // Renderizar escena
                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
                
            } catch (error) {
                console.error('‚ùå Error en animaci√≥n:', error);
            }
        }
        
        // ==========================================
        // UTILIDADES
        // ==========================================
        
        function onWindowResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }
        
        function showError(error) {
            const container = document.getElementById('canvas-container');
            if (container) {
                container.innerHTML = `
                    <div style="color: white; text-align: center; padding: 50px; font-size: 16px;">
                        <h2 style="color: #ff4444;">‚ùå Error al Inicializar la Simulaci√≥n</h2>
                        <p>Ocurri√≥ un problema t√©cnico:</p>
                        <p style="font-family: monospace; background: #333; padding: 10px; border-radius: 5px;">
                            ${error.message}
                        </p>
                        <p>Soluciones sugeridas:</p>
                        <ul style="text-align: left; max-width: 400px; margin: 0 auto;">
                            <li>Verifica tu conexi√≥n a internet</li>
                            <li>Recarga la p√°gina (F5 o Ctrl+R)</li>
                            <li>Usa un navegador moderno (Chrome, Firefox, Edge)</li>
                            <li>Verifica que JavaScript est√© habilitado</li>
                        </ul>
                        <button onclick="location.reload()" 
                                style="margin-top: 20px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üîÑ Recargar P√°gina
                        </button>
                    </div>
                `;
            }
            
            // Ocultar pantalla de carga
            document.getElementById('loading').style.display = 'none';
        }
        
        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        
        // Verificar Three.js y inicializar
        function startApp() {
            if (typeof THREE !== 'undefined') {
                console.log('‚úÖ Three.js detectado correctamente');
                init();
            } else {
                console.error('‚ùå Three.js no est√° disponible');
                showError(new Error('Three.js no se pudo cargar desde el CDN'));
            }
        }
        
        // Iniciar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startApp);
        } else {
            startApp();
        }
        
        // ==========================================
        // INFORMACI√ìN DE DESARROLLO
        // ==========================================
        
        console.log(`
        üåç SIMULACI√ìN DE LA TIERRA CON THREE.JS
        =====================================
        
        üìö Conceptos implementados:
        ‚Ä¢ Scene, Camera, Renderer (base de Three.js)
        ‚Ä¢ Geometr√≠as procedurales (SphereGeometry, RingGeometry)
        ‚Ä¢ Materiales f√≠sicos (MeshPhongMaterial)
        ‚Ä¢ Sistema de iluminaci√≥n realista
        ‚Ä¢ Controles de c√°mara interactivos
        ‚Ä¢ Texturas procedurales con Canvas 2D
        ‚Ä¢ Sistemas de part√≠culas (estrellas)
        ‚Ä¢ Manejo de eventos y UI
        ‚Ä¢ Animaci√≥n y renderizado en tiempo real
        
        üéÆ Controles disponibles:
        ‚Ä¢ C: Agregar cr√°ter
        ‚Ä¢ X: Limpiar cr√°teres  
        ‚Ä¢ W: Toggle wireframe
        ‚Ä¢ M: M√∫ltiples cr√°teres
        ‚Ä¢ R: Resetear vista
        ‚Ä¢ Espacio: Pausar/Reanudar
        
        ¬°Disfruta explorando! üöÄ
        `);
        
    </script>
</body>
</html>